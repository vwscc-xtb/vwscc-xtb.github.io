---
layout: default
title: ONIOM
parent: "Exercises"
nav_order: 4
has_children: false
permalink: page/exercises/oniom
---

# {{ page.title }}
The ONIOM scheme is a multiscale approach designed to efficiently handle large systems using a divide-and-conquer strategy.
The general idea is to partition the system into different subregions—typically an inner and an outer region—and then compute them at different levels of theory.
This method enhances computational efficiency while maintaining the required accuracy in the region of interest (e.g., the ligand pocket in proteins).


## Definition of Inner Region

To perform an ONIOM calculation with xtb, the first step is to define the inner region of the system.
Please use a molecular visualizer of your choice that can display atom numbers and note an appropriate inner region of the DALTES MOC. 
The program accepts the inner region as a CLI argument in the form of a comma-separated list of atom indices (e.g., *1-2,10,23-28*).

{% include note.html content='The boundaries arising from the artificial system decomposition should be properly defined. As the general rule the bonds that higher than single bonds are not a good choice.'%}

 <!-- Tab links -->
<div class="tab card">
  <button class="tablinks tab-id-1" onclick="openTabId(event, 'command', 'tab-id-1')" id="defaultOpen">{{ site.data.icons.code }} <code>daltes.xyz</code></button>
</div>

<div id="command" class="tabcontent tab-id-1" style="font-size:10px">
{% capture struc_xyz %}
432
RhMOP_H_MeOH_153K
C      10.350231    2.219785   13.722494
C      10.523691    0.811935   13.133290
C      10.242715   -0.335202   13.864814
H       9.925900   -0.248298   14.755738
C      10.400405   -1.541931   13.358155
H      10.335895   -2.304207   13.921742
C      10.664178   -1.695876   11.966266
H      10.657011   -2.557471   11.564923
C      10.933686   -0.568603   11.214816
C      10.877777    0.685303   11.795482
H      11.078474    1.459993   11.283130
C      11.163054   -0.707650    9.731842
C      12.573667    4.387428   15.786134
C      13.929805    4.357632   16.463578
C      13.994315    3.903247   17.812771
H      13.225932    3.570527   18.259656
C      15.205665    3.970287   18.433286
H      15.263007    3.677296   19.335595
C      16.361106    4.442054   17.824157
H      17.178230    4.501645   18.305198
C      16.282261    4.826916   16.472117
C      15.059443    4.809535   15.837370
H      14.997800    5.119908   14.940754
C      17.513680    5.355791   15.797520
C      20.499765    4.320388   13.719648
C      20.958501    3.029237   13.101979
C      21.734052    2.083221   13.867661
H      22.016461    2.279377   14.752891
C      22.055167    0.866561   13.255685
H      22.371981    0.158911   13.799347
C      21.933315    0.645575   11.903645
H      22.336143   -0.101802   11.479531
C      21.183568    1.581659   11.186352
C      20.714797    2.736246   11.784096
H      20.203020    3.349542   11.266051
C      20.990039    1.365640    9.748920
C      13.885365   -1.430197    7.116000
C      15.347586   -1.911896    7.116000
C      15.634296   -3.297399    7.116000
H      14.937591   -3.942975    7.116000
C      16.954596   -3.677296    7.116000
H      17.155293   -4.605931    7.116000
C      18.002521   -2.780939    7.116000
H      18.899923   -3.093795    7.116000
C      17.740181   -1.432680    7.116000
C      16.396945   -0.988227    7.116000
H      16.210583   -0.059592    7.116000
C      18.902790   -0.392311    7.116000
C       8.837836   -0.156428    7.116000
C       7.425789    0.332720    7.116000
C       6.462443   -0.585984    7.116000
H       6.691811   -1.509653    7.116000
C       5.163647   -0.213536    7.116000
H       4.494179   -0.886424    7.116000
C       4.755085    1.179416    7.116000
H       3.843348    1.447578    7.116000
C       5.757137    2.050943    7.116000
C       7.129044    1.700842    7.116000
H       7.812848    2.358832    7.116000
C       5.446056    3.577976    7.116000
O      10.760226    3.173250   12.993816
O       9.837020    2.309173   14.875286
O      12.533528    4.789671   14.591500
O      11.581650    3.975253   16.497734
O      17.368892    5.790313   14.609433
O      18.606045    5.365723   16.460731
O      19.665439    4.995759   12.993816
O      20.882523    4.625794   14.880979
O      13.670333   -0.208570    7.116000
O      13.016634   -2.393594    7.116000
O      11.653328    0.350100    9.145483
O      10.991028   -1.820025    9.148330
O       9.699399    0.829316    7.116000
O       9.127413   -1.338327    7.116000
O       6.450975    4.315422    7.116000
O       4.250476    3.885866    7.116000
O      20.134210    2.157711    9.176794
O      21.643738    0.441971    9.139790
O      18.568773    0.856629    7.116000
O      20.066833   -0.923669    7.116000
O      11.631825    5.879700   11.804021
O       8.870807    3.212978   17.673298
O      12.309894    2.639409    7.116000
O      10.510789   -4.206171    7.116000
O      18.603178    3.985185    7.116000
O      23.115994   -1.447578    7.116000
Rh     10.703888    5.051129   13.736157
Rh      9.719756    4.146579   15.724652
Rh     11.704649    0.390325    7.116000
Rh     11.056541   -1.920090    7.116000
Rh     20.077441    2.176582    7.116000
Rh     21.637144    0.356060    7.116000
C      21.573494    7.853670   13.722494
C      22.705998    8.707816   13.133290
C      23.839937    9.038052   13.864814
H      23.923082    8.720231   14.755738
C      24.806149    9.777981   13.358155
H      25.498554   10.103251   13.921742
C      24.807583   10.083388   11.966266
H      25.557329   10.507977   11.564923
C      23.696582    9.753151   11.214816
C      22.638622    9.077780   11.795482
H      21.867372    8.864244   11.283130
C      23.702316   10.021313    9.731842
C      18.584542    8.695401   15.786134
C      17.932277    9.884749   16.463578
C      18.293532   10.167809   17.812771
H      18.965867    9.668730   18.259656
C      17.629798   11.183348   18.433286
H      17.854865   11.379504   19.335595
C      16.643516   11.948107   17.824157
H      16.183346   12.625961   18.305198
C      16.349638   11.687394   16.472117
C      16.976099   10.637092   15.837370
H      16.738130   10.428522   14.940754
C      15.275909   12.489397   15.797520
C      14.679552   15.593123   13.719648
C      15.568353   16.635976   13.101979
C      15.999852   17.780630   13.867661
H      15.688771   17.927126   14.752891
C      16.892953   18.667054   13.255685
H      17.347389   19.295249   13.799347
C      17.145258   18.672020   11.903645
H      17.591092   19.394568   11.479531
C      16.709459   17.554679   11.186352
C      15.943943   16.571418   11.784096
H      15.668702   15.821558   11.266051
C      16.993302   17.495087    9.748920
C      22.966905   12.740178    7.116000
C      22.652957   14.247347    7.116000
C      23.709483   15.188397    7.116000
H      24.616921   14.907821    7.116000
C      23.378333   16.521758    7.116000
H      24.082206   17.159885    7.116000
C      22.078104   16.981110    7.116000
H      21.900343   17.914711    7.116000
C      21.041647   16.079788    7.116000
C      21.328357   14.694284    7.116000
H      20.617316   14.068573    7.116000
C      19.559356   16.566452    7.116000
C      24.387553    7.732004    7.116000
C      24.669962    6.264562    7.116000
C      25.947255    5.889632    7.116000
H      26.632492    6.550105    7.116000
C      26.274104    4.578618    7.116000
H      27.191576    4.335286    7.116000
C      25.272053    3.528317    7.116000
H      25.495687    2.604648    7.116000
C      24.016263    3.960355    7.116000
C      23.633505    5.323512    7.116000
H      22.721768    5.586708    7.116000
C      22.849353    2.927435    7.116000
O      20.542772    7.732004   12.993816
O      21.752688    7.364523   14.875286
O      18.256259    8.459518   14.591500
O      19.437504    8.042377   16.497734
O      14.971996   12.146745   14.609433
O      14.721125   13.430447   16.460731
O      14.511827   14.532890   12.993816
O      14.223683   15.771898   14.880979
O      22.016461   11.943141    7.116000
O      24.235596   12.469533    7.116000
O      22.541140    9.917028    9.145483
O      24.751674   10.428522    9.148330
O      23.103092    7.985268    7.116000
O      25.266319    8.573735    7.116000
O      21.708248    3.428997    7.116000
O      23.180504    1.738087    7.116000
O      16.735263   16.357882    9.176794
O      17.466373   18.523042    9.139790
O      18.644751   15.652715    7.116000
O      19.437504   17.840222    7.116000
O      17.763118    7.133606   11.804021
O      21.453076    6.075856   17.673298
O      20.230258    9.340976    7.116000
O      27.058256   11.205695    7.116000
O      15.918139   14.118232    7.116000
O      18.366643   20.742827    7.116000
Rh     18.944650    6.744274   13.736157
Rh     20.220079    6.344266   15.724652
Rh     22.480644    9.941361    7.116000
Rh     24.805576   10.535290    7.116000
Rh     16.747305   16.299283    7.116000
Rh     17.544072   18.560286    7.116000
C      11.082775   14.756359   13.722494
C       9.776811   15.310064   13.133290
C       8.923849   16.126964   13.864814
H       9.157517   16.357882   14.755738
C       7.799946   16.593765   13.358155
H       7.172051   17.030770   13.921742
C       7.534739   16.442303   11.966266
H       6.792160   16.879308   11.564923
C       8.376233   15.645266   11.214816
C       9.490101   15.066731   11.795482
H      10.060654   14.505578   11.283130
C       8.141130   15.516151    9.731842
C      11.848291   11.746985   15.786134
C      11.144418   10.587433   16.463578
C      10.718653   10.758759   17.812771
H      10.814701   11.590557   18.259656
C      10.171037    9.676179   18.433286
H       9.888628    9.773015   19.335595
C      10.001878    8.439654   17.824157
H       9.644924    7.702208   18.305198
C      10.374601    8.315505   16.472117
C      10.970958    9.383187   15.837370
H      11.270570    9.281385   14.940754
C      10.216911    6.984627   15.797520
C       7.827183    4.916303   13.719648
C       6.479646    5.164601   13.101979
C       5.272597    4.965963   13.867661
H       5.301268    4.623311   14.752891
C       4.058380    5.296199   13.255685
H       3.287130    5.375655   13.799347
C       3.927927    5.512219   11.903645
H       3.079265    5.537049   11.479531
C       5.113473    5.693476   11.186352
C       6.347759    5.522151   11.784096
H       7.134778    5.658715   11.266051
C       5.023159    5.969087    9.748920
C       6.154230   13.519834    7.116000
C       5.005957   12.494363    7.116000
C       3.662720   12.938816    7.116000
H       3.451988   13.864968    7.116000
C       2.673571   11.985351    7.116000
H       1.769001   12.275860    7.116000
C       2.925876   10.629644    7.116000
H       2.206233   10.008898    7.116000
C       4.224672   10.182707    7.116000
C       5.281198   11.123757    7.116000
H       6.178601   10.820833    7.116000
C       4.544354    8.655673    7.116000
C       9.781112   17.254238    7.116000
C      10.910749   18.232533    7.116000
C      10.596802   19.526166    7.116000
H       9.682197   19.789362    7.116000
C      11.568749   20.464733    7.116000
H      11.320744   21.380953    7.116000
C      12.979362   20.122082    7.116000
H      13.667466   20.777589    7.116000
C      13.233100   18.818516    7.116000
C      12.243951   17.805460    7.116000
H      12.471885   16.884274    7.116000
C      14.711090   18.324403    7.116000
O      11.703502   13.924560   12.993816
O      11.416792   15.156119   14.875286
O      12.216713   11.580625   14.591500
O      11.987345   12.812184   16.497734
O      10.665612    6.892756   14.609433
O       9.679330    6.033645   16.460731
O       8.829234    5.301165   12.993816
O       7.900294    4.432122   14.880979
O       7.319706   13.095244    7.116000
O       5.754270   14.753876    7.116000
O       8.812032   14.562686    9.145483
O       7.263798   16.221318    9.148330
O      10.204009   16.015230    7.116000
O       8.612768   17.594406    7.116000
O      14.847277   17.085395    7.116000
O      15.575521   19.205861    7.116000
O       6.137028    6.314222    9.176794
O       3.896389    5.864802    9.139790
O       5.792976    8.320471    7.116000
O       3.502163    7.913262    7.116000
O      13.611557   11.816509   11.804021
O      12.682617   15.540981   17.673298
O      10.466349   12.849429    7.116000
O       5.437455   17.830290    7.116000
O       8.485182    6.726397    7.116000
O       1.523864    5.534566    7.116000
Rh     13.357962   13.034411   13.736157
Rh     13.066665   14.338969   15.724652
Rh      8.821207   14.498129    7.116000
Rh      7.144383   16.214614    7.116000
Rh      6.181754    6.353949    7.116000
Rh      3.825285    5.913469    7.116000
C      10.350231    2.219785    0.509506
C      10.523691    0.811935    1.098710
C      10.242715   -0.335202    0.367186
H       9.925900   -0.248298   -0.523738
C      10.400405   -1.541931    0.873845
H      10.335895   -2.304207    0.310258
C      10.664178   -1.695876    2.265734
H      10.657011   -2.557471    2.667077
C      10.933686   -0.568603    3.017184
C      10.877777    0.685303    2.436518
H      11.078474    1.459993    2.948870
C      11.163054   -0.707650    4.500158
C      12.573667    4.387428   -1.554134
C      13.929805    4.357632   -2.231578
C      13.994315    3.903247   -3.580771
H      13.225932    3.570527   -4.027656
C      15.205665    3.970287   -4.201286
H      15.263007    3.677296   -5.103595
C      16.361106    4.442054   -3.592157
H      17.178230    4.501645   -4.073198
C      16.282261    4.826916   -2.240117
C      15.059443    4.809535   -1.605370
H      14.997800    5.119908   -0.708754
C      17.513680    5.355791   -1.565520
C      20.499765    4.320388    0.512352
C      20.958501    3.029237    1.130021
C      21.734052    2.083221    0.364339
H      22.016461    2.279377   -0.520891
C      22.055167    0.866561    0.976315
H      22.371981    0.158911    0.432653
C      21.933315    0.645575    2.328355
H      22.336143   -0.101802    2.752469
C      21.183568    1.581659    3.045648
C      20.714797    2.736246    2.447904
H      20.203020    3.349542    2.965949
C      20.990039    1.365640    4.483080
O      10.760226    3.173250    1.238184
O       9.837020    2.309173   -0.643286
O      12.533528    4.789671   -0.359500
O      11.581650    3.975253   -2.265734
O      17.368892    5.790313   -0.377433
O      18.606045    5.365723   -2.228731
O      19.665439    4.995759    1.238184
O      20.882523    4.625794   -0.648979
O      11.653328    0.350100    5.086517
O      10.991028   -1.820025    5.083670
O      20.134210    2.157711    5.055206
O      21.643738    0.441971    5.092210
O      11.631825    5.879700    2.427979
O       8.870807    3.212978   -3.441298
Rh     10.703888    5.051129    0.495843
Rh      9.719756    4.146579   -1.492652
C      11.082775   14.756359    0.509506
C       9.776811   15.310064    1.098710
C       8.923849   16.126964    0.367186
H       9.157517   16.357882   -0.523738
C       7.799946   16.593765    0.873845
H       7.172051   17.030770    0.310258
C       7.534739   16.442303    2.265734
H       6.792160   16.879308    2.667077
C       8.376233   15.645266    3.017184
C       9.490101   15.066731    2.436518
H      10.060654   14.505578    2.948870
C       8.141130   15.516151    4.500158
C      11.848291   11.746985   -1.554134
C      11.144418   10.587433   -2.231578
C      10.718653   10.758759   -3.580771
H      10.814701   11.590557   -4.027656
C      10.171037    9.676179   -4.201286
H       9.888628    9.773015   -5.103595
C      10.001878    8.439654   -3.592157
H       9.644924    7.702208   -4.073198
C      10.374601    8.315505   -2.240117
C      10.970958    9.383187   -1.605370
H      11.270570    9.281385   -0.708754
C      10.216911    6.984627   -1.565520
C       7.827183    4.916303    0.512352
C       6.479646    5.164601    1.130021
C       5.272597    4.965963    0.364339
H       5.301268    4.623311   -0.520891
C       4.058380    5.296199    0.976315
H       3.287130    5.375655    0.432653
C       3.927927    5.512219    2.328355
H       3.079265    5.537049    2.752469
C       5.113473    5.693476    3.045648
C       6.347759    5.522151    2.447904
H       7.134778    5.658715    2.965949
C       5.023159    5.969087    4.483080
O      11.703502   13.924560    1.238184
O      11.416792   15.156119   -0.643286
O      12.216713   11.580625   -0.359500
O      11.987345   12.812184   -2.265734
O      10.665612    6.892756   -0.377433
O       9.679330    6.033645   -2.228731
O       8.829234    5.301165    1.238184
O       7.900294    4.432122   -0.648979
O       8.812032   14.562686    5.086517
O       7.263798   16.221318    5.083670
O       6.137028    6.314222    5.055206
O       3.896389    5.864802    5.092210
O      13.611557   11.816509    2.427979
O      12.682617   15.540981   -3.441298
Rh     13.357962   13.034411    0.495843
Rh     13.066665   14.338969   -1.492652
C      21.573494    7.853670    0.509506
C      22.705998    8.707816    1.098710
C      23.839937    9.038052    0.367186
H      23.923082    8.720231   -0.523738
C      24.806149    9.777981    0.873845
H      25.498554   10.103251    0.310258
C      24.807583   10.083388    2.265734
H      25.557329   10.507977    2.667077
C      23.696582    9.753151    3.017184
C      22.638622    9.077780    2.436518
H      21.867372    8.864244    2.948870
C      23.702316   10.021313    4.500158
C      18.584542    8.695401   -1.554134
C      17.932277    9.884749   -2.231578
C      18.293532   10.167809   -3.580771
H      18.965867    9.668730   -4.027656
C      17.629798   11.183348   -4.201286
H      17.854865   11.379504   -5.103595
C      16.643516   11.948107   -3.592157
H      16.183346   12.625961   -4.073198
C      16.349638   11.687394   -2.240117
C      16.976099   10.637092   -1.605370
H      16.738130   10.428522   -0.708754
C      15.275909   12.489397   -1.565520
C      14.679552   15.593123    0.512352
C      15.568353   16.635976    1.130021
C      15.999852   17.780630    0.364339
H      15.688771   17.927126   -0.520891
C      16.892953   18.667054    0.976315
H      17.347389   19.295249    0.432653
C      17.145258   18.672020    2.328355
H      17.591092   19.394568    2.752469
C      16.709459   17.554679    3.045648
C      15.943943   16.571418    2.447904
H      15.668702   15.821558    2.965949
C      16.993302   17.495087    4.483080
O      20.542772    7.732004    1.238184
O      21.752688    7.364523   -0.643286
O      18.256259    8.459518   -0.359500
O      19.437504    8.042377   -2.265734
O      14.971996   12.146745   -0.377433
O      14.721125   13.430447   -2.228731
O      14.511827   14.532890    1.238184
O      14.223683   15.771898   -0.648979
O      22.541140    9.917028    5.086517
O      24.751674   10.428522    5.083670
O      16.735263   16.357882    5.055206
O      17.466373   18.523042    5.092210
O      17.763118    7.133606    2.427979
O      21.453076    6.075856   -3.441298
Rh     18.944650    6.744274    0.495843
Rh     20.220079    6.344266   -1.492652
{% endcapture %}
{% include codecell.html content=struc_xyz %}
</div>

{% include tip.html content='For larger systems, one can use the [**PyMOL**](https://www.pymol.org/) GUI, which can automatically generate a list of atom indices from the selected atom group.'%}


## Dry-Run
When defining the inner region, it is good practice to perform a dry-run with xtb to check whether the specified region is appropriate from a topological perspective using the **--cut** option:
```bash
xtb daltes.xyz <inner_region_list> gfn2:gfnff --cut > cut.out
xtb daltes.xyz <inner_region_list> gfn2:gfn2 --cut > cut.out
```
The ONIOM methods are defined as **high:low**. In our case, we use **gfn2:gfn2** to verify whether the GFN2 wavefunction analysis supports the chosen boundary. Alternatively, one can use **gfn2:gfnff**, but note that the force field topology may overlook important electronic fine details due to the lack of explicit electron treatment.
{% include note.html content='There are interfaces to **ORCA** and **TURBOMOLE** packages that allow for a higher-level treatment of both the inner and outer regions.'%}

## ONIOM Calculation

Now that you have defined the inner region and performed a sanity check, proceed with running the ONIOM geometry optimization on the DALTES MOC:
<!-- Tab links -->
<div class="tab card">
  <button class="tablinks tab-id-5-2" onclick="openTabId(event, 'command-5-2', 'tab-id-5-2')" id="open-5-2">{{ site.data.icons.code }} <code>command</code></button>
  <button class="tablinks tab-id-5-2" onclick="openTabId(event, 'struc-5-2', 'tab-id-5-2')">{{ site.data.icons.codefile }}  <code>xcontrol</code></button>
</div>
<!-- Tab content -->
<div id="command-5-2" class="tabcontent tab-id-5-2" style="text-align:justify">
{% include command.html cmd="xtb daltes.xyz <span class='nt'>--oniom</span> gfn2:gfnff inner_region_list <span class='nt'>--chrg</span> 0:0 <span class='nt'>--opt</span> <span class='nt'>--input</span> xcontrol > oniom.out &" %}
<span markdown="span">
</span>
</div>

<div id="struc-5-2" class="tabcontent tab-id-5-2" style="font-size:10px">
{% capture struc_xyz %}
$oniom
   ignore topo=true
   inner logs=true
$end
{% endcapture %}
{% include codecell.html content=struc_xyz %}
</div>
{% include defaulttab.html id="open-5-2" %}

After the optimization succeeds, you can examine the different `*.log` and `*.xyz` files.
In this case, we are constraining the total charges (via **--chrg**) of the inner:outer regions to 0:0.
Try running the calculation without this constraint and observe how the results change.
In addition, you can try to increase/decrease inner region size (e.g., take more metal nodes, or include organic linkers).

## Optional

It is possible to integrate methods like aISS and ONIOM.
Dock the CO<sub>2</sub> molecule onto the DALTES system in the same manner as described in the [Exercise]({{ "/page/exercises/mof" | absolute_url }}). You may need to pre-optimize both structures using GFN-FF.
\\
Define the inner region, including the docked CO<sub>2</sub> molecule, as demonstrated earlier.Perform the geometry optimization with the selected inner region.